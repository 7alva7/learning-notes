# 01 - 什么是 TDD

> 本文是阅读 [iOS Test-Driven Development by Tutorials](https://store.raywenderlich.com/products/ios-test-driven-development) 后的学习笔记，有需要的请点击链接购买。

测试驱动开发(Test-driven development, 简称 TDD)，是一种通过迭代进行许多由测试支持的小更改的迭代开发软件的方法。

它有四个步骤：
1. 写一个失败的测试
2. 使测试通过
3. 重构
4. 重复

这个步骤也被称为 TDD 循环，能确彻底和准确地测试代码。

## 为什么应该使用 TDD？

TDD 是确保软件能够正常工作并在未来继续良好工作的唯一最佳方法。为什么？

你可以不按照 TDD 的方式来写测试代码。例如，先编写所有代码，然后在写测试；或者完全跳过编写测试代码，直接用手动测试。为什么 TDD 比这些方法更好？

因为 TDD 提供了确保测试良好的方法：

- 第一步是编写一个失败的测试。根据定义，这证明了测试是可能失败的。

- 在编写新的测试之前，所有其他以前的测试都必须通过。这确保了测试的可重复性：不只是运行正在进行的单个测试，而是不断地运行所有测试。

- 通过频繁地运行每个测试，您会受到激励，以确保测试能够快速运行。所有的测试仅需要几秒钟才能运行，最好是一秒钟或更短。

- 重构时，同时更新代码和测试代码。这可以确保测试得到维护。

- 通过并行迭代编写代码和测试，可以确保代码是可测试的。如果在完成代码后编写测试，那么代码很可能需要相当多的重构才能完成单元测试。

## 哪些是需要测试的？

更好的测试覆盖并不总是意味着你的应用程序得到了更好的测试。有些事情你应该测试，有些事情你不应该测试。以下是注意事项：

- 为无法以自动化方式捕获的代码编写测试。这包括类的方法中的代码、自定义的 getter 和 setter 以及您自己编写的大多数其他内容。

- 不要为自动生成的代码编写测试。例如，不值得为生成的 getter 和 setter 编写测试。

- 不要为编译器可能捕捉到的问题编写测试。如果测试的问题将生成错误或警告，Xcode 将为您捕获它。

- 不要为依赖代码编写测试，例如应用程序使用的系统框架或第三方框架。框架作者负责编写这些测试。例如，不应该为 UIKit 类编写测试，因为 UIKit 开发人员负责编写这些测试。但是，应该为自定义子类编写测试：这是自定义代码，因此你要负责编写测试。

上面的一个例外是编写测试以确定框架如何工作。这是非常有用的。但是，不需要长期保存这些测试。相反，后续应该删除它们。

另一个例外是“健全性测试”，它可以确保第三方代码如您所期望的那样工作。如果库不是完全稳定的，或者您不信任它，那么这类测试非常有用。

## TDD 需要花太多时间

关于 TDD 最常见的抱怨是它花费的时间太长了。

但是，一旦你习惯了，TDD 会变得更快。然而，事实是，与根本不编写任何测试相比，您最终编写的代码更多。刚刚开始用 TDD 可能需要更多的时间。

但是，你要知道：开发的成本不仅仅是最开始编写的第一个版本的代码。它还包括随着时间的推移添加新功能、修改现有代码、修复错误等等。从长远来看，遵循 TDD 比不遵循 TDD 花费的时间要少得多，因为它的代码更易于维护，错误更少。

还有另一个要考虑的成本：生产中缺陷对客户的影响。一个问题被发现的时间越长，成本就越高。它可能导致负面评论、失去信任和收入损失。

如果在开发过程中发现了问题，那么调试起来更容易，修复也更快。如果你在几周后发现它，你将花费更多的时间来加速代码的运行并找出根本原因。通过遵循 TDD，你的测试最终有助于保护你的应用程序免受 bug 的影响。

## 什么时候应该使用 TDD？

TDD 可以在产品生命周期的任何时候使用：新开发的、已存在的应用程序以及介于两者之间的一切。然而，如何以及从哪里开始 TDD 确实取决于项目的状态。后面会提到如何处理这些情况。

然而，有一个重要的问题需要问：您的项目是否应该使用 TDD？

一般来说，如果你的应用要持续几个月以上，会有多个版本和/或需要复杂的逻辑，那么你最好还是使用 TDD。

如果你为一些临时性的东西创建一个应用程序，你应该评估 TDD 是否有意义。如果真的只有一个版本的应用程序，你可能不会遵循 TDD，或者只对关键或困难的部分进行 TDD。

归根结底，TDD是一种工具，您可以决定何时最好地使用它！